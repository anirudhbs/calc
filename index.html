<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="Calculator" content="A simple calculator using web components" />
    <link rel="stylesheet" href="/src/css/styles.css" />
    <script type="module" src="/src/my-app.js"></script>
  </head>

  <body>
    <div id="result" class="screen"></div>
    <my-app></my-app>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        document.addEventListener("keydown", addKeyboardListener)
      })

      function addKeyboardListener(event) {
        console.log("we out here")
        const operators = ["+", "-", "x", "รท"]
        // let decimalAdded = false

        const keyPress = String.fromCharCode(event.keyCode)
        const key_code = event.keyCode
        const input = document.querySelector("#result")
        const inputVal = input.textContent
        const lastChar = inputVal[inputVal.length - 1]
        let equation = inputVal
        // Using regex to replace all instances of x, รท, ^ with *, / and ** respectively.
        equation = equation
          .replace(/x/g, "*")
          .replace(/รท/g, "/")
          .replace(/\^/g, "**")

        // Target each keypress and update the input screen

        if (keyPress === "1") {
          input.textContent += keyPress
        }
        if (keyPress === "2") {
          input.textContent += keyPress
        }
        if (keyPress === "3" || key_code === 32) {
          input.textContent += keyPress
        }
        if (keyPress === "4") {
          input.textContent += keyPress
        }
        if (keyPress === "5") {
          input.textContent += keyPress
        }
        if (keyPress === "6" && event.shiftKey === false) {
          input.textContent += keyPress
        }
        if (keyPress === "7") {
          input.textContent += keyPress
        }
        if (keyPress === "8" && event.shiftKey === false) {
          input.textContent += keyPress
        }
        if (keyPress === "9") {
          input.textContent += keyPress
        }
        if (keyPress === "0") {
          input.textContent += keyPress
        }

        // Cature operators and prevent from addint two consecutuve operators

        if (
          (inputVal != "" &&
            operators.indexOf(lastChar) === -1 &&
            key_code === 187 &&
            event.shiftKey) ||
          key_code === 107 ||
          (key_code === 61 && event.shiftKey)
        ) {
          document.querySelector("#result").textContent += "+"
        }
        if (
          (inputVal != "" &&
            operators.indexOf(lastChar) === -1 &&
            key_code === 189 &&
            event.shiftKey) ||
          (inputVal != "" && operators.indexOf(lastChar) === -1 && key_code === 107)
        ) {
          document.querySelector("#result").textContent += "-"
        }
        if (
          (inputVal != "" &&
            operators.indexOf(lastChar) === -1 &&
            key_code === 56 &&
            event.shiftKey) ||
          (inputVal != "" && operators.indexOf(lastChar) === -1 && key_code === 106)
        ) {
          document.querySelector(".screen").textContent += "x"
        }
        if (
          (inputVal != "" && operators.indexOf(lastChar) === -1 && key_code === 191) ||
          (inputVal != "" && operators.indexOf(lastChar) === -1 && key_code === 111)
        ) {
          document.querySelector("#result").textContent += "รท"
        }
        if (
          inputVal != "" &&
          operators.indexOf(lastChar) === -1 &&
          key_code === 54 &&
          event.shiftKey
        ) {
          document.querySelector("#result").textContent += "^"
        }
        if (key_code === 13 || (key_code === 187 && event.shiftKey === false)) {
          input.textContent = eval(equation)
          //reset decimal added flag
          // decimalAdded = false
        }
        if (key_code === 8 || key_code === 46) {
          input.textContent = ""
          // decimalAdded = false
        }
      }
    </script>
  </body>
</html>
